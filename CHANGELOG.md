# Changelog

## [Unreleased] - 2024-08-17

### Added
- **Voice Message Transcription**: Добавлена поддержка транскрибации голосовых сообщений с помощью OpenAI Whisper
  - Автоматическое распознавание голосовых сообщений от пользователей
  - Транскрибация с использованием модели GPT-4o-mini transcribe (Whisper)
  - Обработка транскрибированного текста как обычного текстового сообщения
  - Поддержка формата OGG (стандартный формат голосовых сообщений Telegram)
  - Обработка ошибок транскрибации с уведомлением пользователя

### Technical Details
- Добавлен метод `TranscribeAudio` в интерфейс `ModelStrategy`
- Реализована транскрибация в `GPTStrategy` с использованием OpenAI Whisper API
- Добавлена заглушка для `LocalStrategy`
- Модифицирована функция `handleUserMessage` для обработки голосовых сообщений
- Добавлена функция `handleVoiceMessage` для скачивания и транскрибации аудио
- Добавлены тесты для проверки функциональности транскрибации

## [Unreleased] - 2024-08-16

### Added
- **Amo CRM Tags Support**: Добавлена возможность автоматически добавлять теги к создаваемым лидам в Amo CRM
  - Статические теги через переменную окружения `AMO_LEAD_TAGS`
  - Динамические теги на основе содержимого разговора
  - Настраиваемая карта ключевых слов и тегов через `AMO_KEYWORD_TAGS_MAP`
  - Автоматическое определение новых/повторных клиентов
  - Теги на основе интереса клиента

### Changed
- Обновлена структура `lead` в Amo CRM клиенте для поддержки поля `tags`
- Расширена конфигурация Amo CRM для поддержки тегов
- Обновлена функция `buildLead` для объединения статических и динамических тегов

### Technical Details
- Добавлена функция `generateDynamicTags` для анализа содержимого разговора
- Добавлена функция `loadKeywordTagsMap` для загрузки конфигурации ключевых слов
- Добавлены тесты для проверки функциональности тегов
- Создана документация по настройке тегов (`AMO_TAGS_CONFIG.md`)

### Configuration
Новые переменные окружения:
- `AMO_LEAD_TAGS` - статические теги (через запятую)
- `AMO_DYNAMIC_TAGS_ENABLED` - включение/выключение динамических тегов
- `AMO_KEYWORD_TAGS_MAP` - JSON-карта ключевых слов и тегов

## [Unreleased] - 2024-08-16 (Part 2)

### Added
- **Auto-delete Messages with Buttons**: Добавлена автоматическое удаление сообщений с inline-кнопками после нажатия
  - Улучшен пользовательский опыт за счет очистки интерфейса
  - Автоматическое удаление работает для всех типов кнопок
  - Обработка ошибок при удалении сообщений

### Changed
- Обновлена функция `handleCallbackQuery` для извлечения `messageID`
- Добавлена функция `deleteMessage` для удаления сообщений
- Модифицирована обработка всех типов callback запросов

### Technical Details
- Добавлена функция `deleteMessage` для работы с Telegram API
- Обновлена логика обработки callback запросов
- Добавлены unit тесты для проверки функциональности
- Создана документация по новой функциональности (`MESSAGE_DELETION.md`)

### User Experience
- Сообщения с кнопками автоматически исчезают после использования
- Чистый интерфейс без накопления старых сообщений
- Улучшенная навигация в чате с ботом
